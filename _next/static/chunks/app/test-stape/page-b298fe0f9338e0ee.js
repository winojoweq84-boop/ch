(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[847],{4281:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});var o=n(5155),a=n(2115),s=n(5704);async function i(e){let t=function(){let e=s.env.STAPE_GTM_ENDPOINT||"https://seooruya.gtm-server.com/gtm",t=s.env.STAPE_API_KEY||"",n=s.env.STAPE_CONTAINER_DOMAIN||"cars-vault.com";return t||console.warn("⚠️ STAPE_API_KEY not found in environment variables"),{endpoint:e,api_key:t,container_domain:n}}();if(!t.api_key)return console.warn("⚠️ Stape.io API key not configured, skipping S2S tracking"),!1;let n={client_name:t.container_domain,events:[{name:e.event_type,timestamp_micros:1e3*Date.now(),params:{lead_id:e.lead_id,lead_name:e.name,lead_email:e.email,lead_phone:e.phone,lead_city:e.city,car_brand:e.brand,car_model:e.model,payout_method:e.payout_method,crypto_token:e.crypto_token,source:e.source,user_agent:e.user_agent,ip_address:e.ip_address,session_id:e.session_id,...e.custom_properties,conversion_value:1,currency:"USD"}}]};try{console.log("\uD83D\uDE80 Sending Stape.io S2S conversion:",{event_type:e.event_type,lead_id:e.lead_id,name:e.name,email:e.email,city:e.city,brand:e.brand,model:e.model,payout_method:e.payout_method});let o=await fetch(t.endpoint,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t.api_key),"User-Agent":"Cars-Vault-Website/1.0"},body:JSON.stringify(n)});if(!o.ok){let e=await o.text().catch(()=>"Unknown error");throw Error("Stape.io S2S request failed: ".concat(o.status," ").concat(e))}let a=await o.json().catch(()=>({}));return console.log("✅ Stape.io S2S conversion sent successfully:",a),!0}catch(e){return console.error("❌ Stape.io S2S tracking failed:",e),console.log("\uD83D\uDCCB Stape.io data for manual processing:",{config:{endpoint:t.endpoint,container_domain:t.container_domain},data:n,error:e instanceof Error?e.message:String(e)}),!1}}function r(){let[e,t]=(0,a.useState)(""),[n,s]=(0,a.useState)(!1),r=async()=>{s(!0),t("Testing Stape.io integration...\n");try{let e=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{lead_id:t.leadId,name:e.name,email:e.email,phone:e.phone,city:e.city,brand:e.brand,model:e.model,payout_method:e.payoutMethod,crypto_token:e.token,event_type:"lead_submission",source:e.source||"website",timestamp:new Date().toISOString(),user_agent:t.userAgent,ip_address:t.ipAddress,session_id:t.sessionId,custom_properties:t.customProperties}}({name:"Test User",email:"test@example.com",phone:"+971501234567",city:"Dubai",brand:"BMW",model:"X5",payoutMethod:"crypto",token:"USDC",source:"test_page"},{leadId:"test-lead-"+Date.now(),userAgent:navigator.userAgent,ipAddress:"127.0.0.1",sessionId:"test-session-"+Date.now(),customProperties:{test_mode:!0,browser_test:!0}});t(e=>e+"✅ Conversion data created successfully\n"),t(t=>t+"\uD83D\uDCCA Data: ".concat(JSON.stringify(e,null,2),"\n\n")),t(e=>e+"\uD83D\uDE80 Sending to Stape.io S2S endpoint...\n"),await i(e)?(t(e=>e+"✅ SUCCESS: Stape.io S2S tracking sent successfully!\n"),t(e=>e+"\uD83C\uDF89 Check your Stape.io dashboard for the conversion.\n")):(t(e=>e+"⚠️ FAILED: Stape.io S2S tracking failed.\n"),t(e=>e+"\uD83D\uDCA1 Check your API key and endpoint configuration.\n"))}catch(e){t(t=>t+"❌ ERROR: ".concat(e instanceof Error?e.message:String(e),"\n")),t(e=>e+"\uD83D\uDCA1 Make sure your .env.local file is configured correctly.\n")}finally{s(!1)}};return(0,o.jsx)("div",{className:"min-h-screen bg-gray-900 text-white p-8",children:(0,o.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,o.jsx)("h1",{className:"text-3xl font-bold mb-8",children:"\uD83E\uDDEA Stape.io Integration Test"}),(0,o.jsxs)("div",{className:"bg-gray-800 p-6 rounded-lg mb-6",children:[(0,o.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Test Instructions:"}),(0,o.jsxs)("ol",{className:"list-decimal list-inside space-y-2 text-gray-300",children:[(0,o.jsxs)("li",{children:["Make sure you have created ",(0,o.jsx)("code",{className:"bg-gray-700 px-2 py-1 rounded",children:".env.local"})," with your Stape.io API key"]}),(0,o.jsx)("li",{children:"Update the endpoint URL with your actual Stape.io container domain"}),(0,o.jsx)("li",{children:'Click the "Test Stape.io Integration" button below'}),(0,o.jsx)("li",{children:"Check the results and your Stape.io dashboard"})]})]}),(0,o.jsx)("button",{onClick:r,disabled:n,className:"bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 text-white px-6 py-3 rounded-lg font-semibold mb-6",children:n?"Testing...":"Test Stape.io Integration"}),e&&(0,o.jsxs)("div",{className:"bg-gray-800 p-6 rounded-lg",children:[(0,o.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Test Results:"}),(0,o.jsx)("pre",{className:"whitespace-pre-wrap text-sm text-gray-300 font-mono",children:e})]}),(0,o.jsxs)("div",{className:"bg-yellow-900 border border-yellow-600 p-4 rounded-lg mt-6",children:[(0,o.jsx)("h3",{className:"font-semibold text-yellow-200 mb-2",children:"\uD83D\uDD27 Configuration Check:"}),(0,o.jsxs)("p",{className:"text-yellow-100 text-sm",children:["Make sure your ",(0,o.jsx)("code",{className:"bg-yellow-800 px-1 rounded",children:".env.local"})," file contains:"]}),(0,o.jsx)("pre",{className:"text-xs text-yellow-100 mt-2 bg-yellow-800 p-2 rounded",children:"STAPE_S2S_ENDPOINT=https://track.YOUR_DOMAIN.com/s2s\nSTAPE_API_KEY=your_actual_api_key\nSTAPE_CONTAINER_DOMAIN=your_domain.com"})]})]})})}},7648:(e,t,n)=>{Promise.resolve().then(n.bind(n,4281))}},e=>{e.O(0,[441,255,358],()=>e(e.s=7648)),_N_E=e.O()}]);